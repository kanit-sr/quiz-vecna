<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dolindar Tomb Puzzle - Drag & Drop</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Cinzel&display=swap');
  body {
    margin: 0; padding: 2rem;
    background: #121212;
    color: #e0d8c3;
    font-family: 'Cinzel', serif;
    display: flex; flex-direction: column; align-items: center; min-height: 100vh;
  }
  h1 {
    letter-spacing: 0.15em; margin-bottom: 1rem;
    text-shadow: 0 0 10px #5a2e1a;
  }
  p {
    font-style: italic; margin-bottom: 2rem; color: #bfae7e; max-width: 600px; text-align: center;
  }
  .puzzle-container {
    background: #1e1b16;
    border: 2px solid #5a2e1a;
    border-radius: 12px;
    padding: 1.5rem 2rem;
    max-width: 700px;
    width: 100%;
    box-shadow: 0 0 15px #5a2e1a;
  }
  .letter-pool, .slots {
    display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;
    margin-bottom: 2rem;
  }
  .word-group {
    margin-bottom: 1rem;
    text-align: center;
  }
  .word-label {
    color: #d7c4a3;
    font-weight: 700;
    letter-spacing: 0.1em;
    margin-bottom: 0.3rem;
    text-transform: uppercase;
  }
  .letter {
    user-select: none;
    background: #2d2922;
    border: 1.5px solid #5a2e1a;
    border-radius: 6px;
    width: 40px;
    height: 40px;
    line-height: 40px;
    font-size: 1.6rem;
    text-align: center;
    cursor: grab;
    transition: background 0.3s ease;
    color: #e0d8c3;
    font-family: 'Cinzel', serif;
  }
  .letter:active {
    cursor: grabbing;
    background: #5a2e1a;
  }
  .slot {
    width: 50px;
    height: 50px;
    border: 2px dashed #5a2e1a;
    border-radius: 8px;
    font-size: 2rem;
    text-align: center;
    line-height: 50px;
    color: #bfae7e;
    user-select: none;
    background: #121212;
    transition: background-color 0.3s ease, border-color 0.3s ease;
  }
  .slot.hovered {
    background-color: #5a2e1a;
    border-color: #7b4a28;
  }
  .slot.filled {
    border-style: solid;
    color: #6ade87;
  }
  button.unlock-btn {
    background: #5a2e1a;
    border: none;
    color: #e0d8c3;
    font-family: 'Cinzel', serif;
    font-size: 1.2rem;
    padding: 0.6rem 1.2rem;
    cursor: pointer;
    border-radius: 8px;
    letter-spacing: 0.1em;
    transition: background 0.3s ease;
  }
  button.unlock-btn:hover {
    background: #7b4a28;
  }
  .result {
    margin-top: 1.8rem;
    font-weight: 700;
    font-size: 1.3rem;
    letter-spacing: 0.1em;
    text-align: center;
    min-height: 1.5em;
  }
  .success {
    color: #6ade87;
    text-shadow: 0 0 8px #44b34a;
  }
  .failure {
    color: #d25757;
    text-shadow: 0 0 8px #b22a2a;
  }
  footer {
    margin-top: auto;
    font-size: 0.8rem;
    color: #555142;
    font-style: italic;
    text-align: center;
    padding: 1rem 0 0 0;
    user-select: none;
  }
</style>
</head>
<body>

<h1>Dolindar Tomb Puzzle</h1>
<p>Drag letters from the pools below and drop them into the slots to spell <strong>A WORD</strong>.</p>

<div class="puzzle-container" role="main" aria-label="Dolindar Tomb Puzzle">

  <!-- Letter pools by word -->
  <div id="letter-pools">
    <div class="word-group" aria-label="Letters from DOLINDAR">
      <div class="word-label">DOLINDAR</div>
      <div class="letter-pool" data-word="DOLINDAR">
        <div class="letter" draggable="true" data-word="DOLINDAR" data-letter="D">D</div>
        <div class="letter" draggable="true" data-word="DOLINDAR" data-letter="O">O</div>
        <div class="letter" draggable="true" data-word="DOLINDAR" data-letter="L">L</div>
        <div class="letter" draggable="true" data-word="DOLINDAR" data-letter="I">I</div>
        <div class="letter" draggable="true" data-word="DOLINDAR" data-letter="N">N</div>
        <div class="letter" draggable="true" data-word="DOLINDAR" data-letter="D">D</div>
        <div class="letter" draggable="true" data-word="DOLINDAR" data-letter="A">A</div>
        <div class="letter" draggable="true" data-word="DOLINDAR" data-letter="R">R</div>
      </div>
    </div>

    <div class="word-group" aria-label="Letters from NO">
      <div class="word-label">NO</div>
      <div class="letter-pool" data-word="NO">
        <div class="letter" draggable="true" data-word="NO" data-letter="N">N</div>
        <div class="letter" draggable="true" data-word="NO" data-letter="O">O</div>
      </div>
    </div>

    <div class="word-group" aria-label="Letters from WORLD">
      <div class="word-label">WORLD</div>
      <div class="letter-pool" data-word="WORLD">
        <div class="letter" draggable="true" data-word="WORLD" data-letter="W">W</div>
        <div class="letter" draggable="true" data-word="WORLD" data-letter="O">O</div>
        <div class="letter" draggable="true" data-word="WORLD" data-letter="R">R</div>
        <div class="letter" draggable="true" data-word="WORLD" data-letter="L">L</div>
        <div class="letter" draggable="true" data-word="WORLD" data-letter="D">D</div>
      </div>
    </div>

    <div class="word-group" aria-label="Letters from TO">
      <div class="word-label">TO</div>
      <div class="letter-pool" data-word="TO">
        <div class="letter" draggable="true" data-word="TO" data-letter="T">T</div>
        <div class="letter" draggable="true" data-word="TO" data-letter="O">O</div>
      </div>
    </div>

    <div class="word-group" aria-label="Letters from RETURN">
      <div class="word-label">RETURN</div>
      <div class="letter-pool" data-word="RETURN">
        <div class="letter" draggable="true" data-word="RETURN" data-letter="R">R</div>
        <div class="letter" draggable="true" data-word="RETURN" data-letter="E">E</div>
        <div class="letter" draggable="true" data-word="RETURN" data-letter="T">T</div>
        <div class="letter" draggable="true" data-word="RETURN" data-letter="U">U</div>
        <div class="letter" draggable="true" data-word="RETURN" data-letter="R">R</div>
        <div class="letter" draggable="true" data-word="RETURN" data-letter="N">N</div>
      </div>
    </div>
  </div>

  <!-- Drop slots for ALONE -->
  <div class="slots" aria-label="Puzzle slots to drop letters" role="list">
    <div class="slot" data-position="0" aria-label="Slot for letter A" role="listitem" tabindex="0"></div>
    <div class="slot" data-position="1" aria-label="Slot for letter L" role="listitem" tabindex="0"></div>
    <div class="slot" data-position="2" aria-label="Slot for letter O" role="listitem" tabindex="0"></div>
    <div class="slot" data-position="3" aria-label="Slot for letter N" role="listitem" tabindex="0"></div>
    <div class="slot" data-position="4" aria-label="Slot for letter E" role="listitem" tabindex="0"></div>
  </div>

  <button id="unlock-btn" class="unlock-btn" aria-label="Attempt to unlock the puzzle door">Unlock</button>
  <div id="result-message" class="result" aria-live="polite"></div>
</div>

<footer>Vecna: Eve of Ruin — Dolindar Tomb Puzzle</footer>

<script>
(() => {
  const slots = document.querySelectorAll('.slot');
  const letters = document.querySelectorAll('.letter');
  const unlockBtn = document.getElementById('unlock-btn');
  const resultEl = document.getElementById('result-message');

  // To track what letter is in each slot
  let slotLetters = Array(slots.length).fill(null);

  // Track letter origin for returning on removal
  const letterOrigins = new Map();

  letters.forEach(letter => {
    letter.addEventListener('dragstart', e => {
      e.dataTransfer.setData('text/plain', letter.dataset.letter);
      e.dataTransfer.setData('text/word', letter.dataset.word);
      letter.classList.add('dragging');
    });

    letter.addEventListener('dragend', e => {
      letter.classList.remove('dragging');
    });
  });

  slots.forEach(slot => {
    slot.addEventListener('dragover', e => {
      e.preventDefault();
      slot.classList.add('hovered');
    });

    slot.addEventListener('dragleave', e => {
      slot.classList.remove('hovered');
    });

    slot.addEventListener('drop', e => {
      e.preventDefault();
      slot.classList.remove('hovered');

      const draggedLetter = e.dataTransfer.getData('text/plain');
      const draggedWord = e.dataTransfer.getData('text/word');

      // Check if this slot already filled: if yes, return old letter to pool
      const pos = Number(slot.dataset.position);
      if (slotLetters[pos]) {
        returnLetterToPool(slotLetters[pos]);
      }

      // Check if letter from this word already placed in another slot — only one letter per word allowed
      for(let i = 0; i < slotLetters.length; i++) {
        if(slotLetters[i] && slotLetters[i].word === draggedWord) {
          // Return that letter to pool
          returnLetterToPool(slotLetters[i]);
          slotLetters[i] = null;
          slots[i].textContent = '';
          slots[i].classList.remove('filled');
          break;
        }
      }

      // Remove letter from pool UI
      removeLetterFromPool(draggedLetter, draggedWord);

      // Place letter in slot
      slot.textContent = draggedLetter;
      slot.classList.add('filled');

      // Save slot letter info
      slotLetters[pos] = { letter: draggedLetter, word: draggedWord };
      clearResult();
    });
  });

  // Clicking a slot removes the letter and returns it to pool
  slots.forEach(slot => {
    slot.addEventListener('click', () => {
      const pos = Number(slot.dataset.position);
      if (slotLetters[pos]) {
        returnLetterToPool(slotLetters[pos]);
        slotLetters[pos] = null;
        slot.textContent = '';
        slot.classList.remove('filled');
        clearResult();
      }
    });
  });

  function removeLetterFromPool(letter, word) {
    // Find the letter div in pool and hide it
    const pool = document.querySelector(`.letter-pool[data-word="${word}"]`);
    if (!pool) return;
    const letterDiv = Array.from(pool.children).find(div => div.dataset.letter === letter && !div.classList.contains('used'));
    if (letterDiv) {
      letterDiv.classList.add('used');
      letterDiv.style.visibility = 'hidden';
    }
  }

  function returnLetterToPool(slotLetterObj) {
    const pool = document.querySelector(`.letter-pool[data-word="${slotLetterObj.word}"]`);
    if (!pool) return;
    const letterDiv = Array.from(pool.children).find(div => div.dataset.letter === slotLetterObj.letter && div.classList.contains('used'));
    if (letterDiv) {
      letterDiv.classList.remove('used');
      letterDiv.style.visibility = 'visible';
    }
  }

  function clearResult() {
    resultEl.textContent = '';
    resultEl.className = 'result';
  }

  unlockBtn.addEventListener('click', () => {
    // Check if all slots filled
    if (slotLetters.some(l => l === null)) {
      resultEl.textContent = 'Please fill all slots with letters.';
      resultEl.className = 'result failure';
      return;
    }

    // Desired code ALONE, slots order: 0:A,1:L,2:O,3:N,4:E
    const correct = ['A','L','O','N','E'];
    const userCode = slotLetters.map(l => l.letter);

    let isCorrect = correct.every((ch, i) => ch === userCode[i]);

    if (isCorrect) {
      resultEl.textContent = "✨ The door creaks open... The tomb yields its secrets. You have unlocked the Dolindar Tomb! ✨";
      resultEl.className = 'result success';
    } else {
      resultEl.textContent = "⚠️ The runes glow briefly, but nothing happens. The code is incorrect.";
      resultEl.className = 'result failure';
    }
  });
})();
</script>

</body>
</html>
